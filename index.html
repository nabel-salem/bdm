<!-- ÙƒÙˆØ¯ HTML ÙƒØ§Ù…Ù„ Ù…Ø­ÙÙˆØ¸ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø·Ø±Ø© Ø£Ù…Ù„</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Arial', sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #b30000;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 20px;
    }
    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-around;
      background-color: #ffcccc;
      padding: 10px;
    }
    nav button {
      background-color: #b30000;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
    .section {
      display: none;
      padding: 20px;
    }
    .active {
      display: block;
    }
    input, select, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .field-label {
      color: #b30000;
      font-size: 14px;
      margin-top: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
    }
    td, th {
      padding: 10px;
      text-align: center;
    }
    thead {
      background-color: #b30000;
      color: white;
    }
    tbody tr {
      border: 2px solid #b30000;
      margin-bottom: 10px;
    }
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead {
        display: none;
      }
      tr {
        margin-bottom: 15px;
        border: 2px solid #b30000;
        padding: 10px;
        border-radius: 10px;
        background-color: #fff;
      }
      td {
        text-align: right;
        padding-right: 50%;
        position: relative;
        border: none;
        border-bottom: 1px solid #eee;
      }
      td::before {
        content: attr(data-label);
        position: absolute;
        right: 10px;
        top: 10px;
        font-weight: bold;
        color: #b30000;
      }
      td:last-child {
        border-bottom: none;
      }
    }
    .popup-message, .update-date-popup {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border: 2px solid red;
      border-radius: 10px;
      z-index: 1000;
      text-align: center;
    }
    .popup-message.active, .update-date-popup.active {
      display: block;
    }
  </style>
</head>
<body>

<header>ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø·Ø±Ø© Ø£Ù…Ù„ ... Ù‚Ø·Ø±Ø© Ø£Ù…Ù„ ØªÙ†Ù‚Ø° Ø­ÙŠØ§Ø©</header>
<header>ØªÙ… ØªØµÙ…ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªØ³Ù‡ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ† Ø¨Ø§Ù„Ø¯Ù…ØŒ ÙˆØªÙˆÙÙŠØ± ÙØµØ§Ø¦Ù„ Ø§Ù„Ø¯Ù… Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ø¨Ø³Ø±Ø¹Ø© ÙˆØ³Ù‡ÙˆÙ„Ø© Ù„ÙƒÙ„ Ù…Ù† ÙŠØ­ØªØ§Ø¬ Ø¥Ù„ÙŠÙ‡Ø§</header>
<header>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù† Ø§Ù„Ù…ØªØ¨Ø±Ø¹ÙŠÙ† ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ù… Ø§Ù„ØµØ­ÙŠØ­Ø© ÙˆÙƒØ§Ù…Ù„Ø© Ø­ØªÙ‰ ÙŠØªØ³Ù‡Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ† Ø¹Ù† Ø§Ù„Ø¯Ù… Ø§ÙŠØ¬Ø§Ø¯Ù‡</header>

<nav>
  <button onclick="showSection('register')">ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ¨Ø±Ø¹ Ø¬Ø¯ÙŠØ¯</button>
  <button onclick="showPasswordPopup()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
  <button onclick="showSection('search')">Ø¨Ø­Ø« Ø¹Ù† Ù…ØªØ¨Ø±Ø¹</button>
</nav>

<!-- ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ¨Ø±Ø¹ -->
<div id="register" class="section active">
  <h3>ØªØ³Ø¬ÙŠÙ„ Ù…ØªØ¨Ø±Ø¹ Ø¬Ø¯ÙŠØ¯</h3>
  <input type="text" id="donorName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
  <input type="text" id="donorPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
  <input type="text" id="donorCity" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©">
  <input type="text" id="donorArea" placeholder="Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©">
  <input type="text" id="donorLocation" placeholder="Ù…ÙƒØ§Ù† Ø§Ù„Ø³ÙƒÙ†">
  <label class="field-label">ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± ØªØ¨Ø±Ø¹ Ù„Ùƒ (ÙˆØ¥Ø°Ø§ Ù„Ù… ØªØªØ¨Ø±Ø¹ Ø¨Ø¹Ø¯ ÙØ§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹) ÙˆÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„Ù‡ Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø­Ø§Ù„ Ù‚Ù…Øª Ø¨Ø§Ù„ØªØ¨Ø±Ø¹.</label>
  <input type="date" id="donorLastDate">
  <select id="donorBlood">
    <option disabled selected value="">Ø§Ø®ØªØ± ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…</option>
    <option>+A</option><option>-A</option>
    <option>+B</option><option>-B</option>
    <option>+AB</option><option>-AB</option>
    <option>+O</option><option>-O</option>
  </select>
  <button onclick="addDonor()">ØªØ³Ø¬ÙŠÙ„</button>
</div>

<!-- ØªØ¹Ø¯ÙŠÙ„ -->
<div id="edit" class="section">
  <h3>ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ¨Ø±Ø¹</h3>
  <input type="text" id="editName" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¨Ø±Ø¹">
  <button onclick="editDonor()">Ø¨Ø­Ø«</button>
  <div id="editSection" style="display:none;">
    <input type="text" id="editNewName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    <input type="text" id="editPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <input type="text" id="editCity" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©">
    <input type="text" id="editArea" placeholder="Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©">
    <input type="text" id="editLocation" placeholder="Ù…ÙƒØ§Ù† Ø§Ù„Ø³ÙƒÙ†">
    <input type="date" id="editLastDate">
    <select id="editBlood">
      <option>+A</option><option>-A</option>
      <option>+B</option><option>-B</option>
      <option>+AB</option><option>-AB</option>
      <option>+O</option><option>-O</option>
    </select>
    <button onclick="saveEdit()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
    <button onclick="deleteDonor()">Ø­Ø°Ù Ø§Ù„Ù…ØªØ¨Ø±Ø¹</button>
  </div>
</div>

<!-- Ø§Ù„Ø¨Ø­Ø« -->
<div id="search" class="section">
  <h3>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ØªØ¨Ø±Ø¹ÙŠÙ†</h3>
  <select id="searchBlood" onchange="searchDonors()">
    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØµØ§Ø¦Ù„</option>
    <option>+A</option><option>-A</option>
    <option>+B</option><option>-B</option>
    <option>+AB</option><option>-AB</option>
    <option>+O</option><option>-O</option>
  </select>
  <input type="text" id="searchQuery" oninput="searchDonors()" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ© Ø£Ùˆ Ø§Ù„Ø³ÙƒÙ†">
  <table>
    <thead>
      <tr>
        <th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„ÙØµÙŠÙ„Ø©</th><th>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</th><th>Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©</th><th>Ø§Ù„Ø³ÙƒÙ†</th><th>Ø¢Ø®Ø± ØªØ¨Ø±Ø¹</th><th>ØªØ¹Ø¯ÙŠÙ„</th>
      </tr>
    </thead>
    <tbody id="donorsTable"></tbody>
  </table>
</div>

<!-- Ù†ÙˆØ§ÙØ° Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="successPopup" class="popup-message"></div>
<div id="passwordPopup" class="popup-message">
  <p>Ø§Ø°Ø§ Ø±ØºØ¨Øª Ø¨ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ø±Ø¬Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ§Ù„ÙŠ:00966511479262 Ù†Ø¨ÙŠÙ„ Ø§Ù„ÙŠØ§ÙØ¹ÙŠ</p>
  <input type="password" id="passwordInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button onclick="checkPassword()">Ø¯Ø®ÙˆÙ„</button>
  <button onclick="closePasswordPopup()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>
<div id="updateDatePopup" class="update-date-popup">
  <h3>ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¨Ø±Ø¹</h3>
  <input type="date" id="newDonationDate">
  <button onclick="saveDonationDate()">Ø­ÙØ¸ Ø§Ù„ØªØ­Ø¯ÙŠØ«</button>
  <button onclick="closeUpdateDatePopup()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
  const donorsData = JSON.parse(localStorage.getItem('donors')) || [];
  let currentDonorIndex = null;

  function showSection(id) {
    document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }

  function showPasswordPopup() {
    document.getElementById("passwordPopup").classList.add("active");
  }

  function closePasswordPopup() {
    document.getElementById("passwordPopup").classList.remove("active");
  }

  function checkPassword() {
    if (document.getElementById("passwordInput").value === "Na@7363Nabel") {
      closePasswordPopup();
      showSection("edit");
    } else {
      alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }
  }

  function addDonor() {
    const d = {
      name: donorName.value.trim(),
      phone: donorPhone.value.trim(),
      city: donorCity.value.trim(),
      area: donorArea.value.trim(),
      location: donorLocation.value.trim(),
      lastDate: donorLastDate.value,
      blood: donorBlood.value
    };

    const duplicate = donorsData.find(x =>
      x.name === d.name && x.phone === d.phone
    );

    if (duplicate) {
      showMessage("Ø§Ù„Ù…ØªØ¨Ø±Ø¹ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§(ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ)");
      return;
    }

    if (d.name && d.phone && d.city && d.area && d.location && d.blood) {
      donorsData.push(d);
      localStorage.setItem('donors', JSON.stringify(donorsData));
      renderSearchTable();
      showMessage("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ± ÙˆØ¬Ø¹Ù„Ù‡Ø§ Ø§Ù„Ù„Ù‡ ÙÙŠ Ù…ÙŠØ²Ø§Ù† Ø­Ø³Ù†Ø§ØªÙƒ");
      document.querySelectorAll("#register input").forEach(i => i.value = "");
      donorBlood.selectedIndex = 0;
    } else {
      showMessage("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ( Ù„ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¨Ù†Ø¬Ø§Ø­)");
    }
  }

  function editDonor() {
    const name = editName.value.toLowerCase();
    const donor = donorsData.find(d => d.name.toLowerCase() === name);
    if (donor) {
      document.getElementById("editSection").style.display = "block";
      editNewName.value = donor.name;
      editPhone.value = donor.phone;
      editCity.value = donor.city;
      editArea.value = donor.area;
      editLocation.value = donor.location;
      editLastDate.value = donor.lastDate;
      editBlood.value = donor.blood;
      currentDonorIndex = donorsData.indexOf(donor);
    } else {
      showMessage("Ø§Ù„Ù…ØªØ¨Ø±Ø¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
    }
  }

  function saveEdit() {
    if (currentDonorIndex !== null) {
      donorsData[currentDonorIndex] = {
        name: editNewName.value,
        phone: editPhone.value,
        city: editCity.value,
        area: editArea.value,
        location: editLocation.value,
        lastDate: editLastDate.value,
        blood: editBlood.value
      };
      localStorage.setItem('donors', JSON.stringify(donorsData));
      renderSearchTable();
      showMessage("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„");
      document.getElementById("editSection").style.display = "none";
    }
  }

  function deleteDonor() {
    if (currentDonorIndex !== null) {
      donorsData.splice(currentDonorIndex, 1);
      localStorage.setItem('donors', JSON.stringify(donorsData));
      renderSearchTable();
      showMessage("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØªØ¨Ø±Ø¹");
      document.getElementById("editSection").style.display = "none";
    }
  }

  function renderSearchTable() {
    const tbody = document.getElementById("donorsTable");
    tbody.innerHTML = "";
    donorsData.forEach((d, index) => {
      tbody.innerHTML += `<tr>
        <td data-label="Ø§Ù„Ø§Ø³Ù…">${d.name}</td>
        <td data-label="Ø§Ù„Ù‡Ø§ØªÙ"><a href="tel:${d.phone}">ğŸ“ Ø§ØªØµØ§Ù„</a><br>${d.phone}</td>
        <td data-label="Ø§Ù„ÙØµÙŠÙ„Ø©">${d.blood}</td>
        <td data-label="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©">${d.city}</td>
        <td data-label="Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©">${d.area}</td>
        <td data-label="Ø§Ù„Ø³ÙƒÙ†">${d.location}</td>
        <td data-label="Ø¢Ø®Ø± ØªØ¨Ø±Ø¹">${d.lastDate || "â€”"}</td>
        <td data-label="ØªØ¹Ø¯ÙŠÙ„"><button onclick="enableEditDate(${index})">ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® ØªØ¨Ø±Ø¹Ùƒ</button></td>
      </tr>`;
    });
  }

  function searchDonors() {
    const blood = searchBlood.value;
    const query = searchQuery.value.toLowerCase();
    const filtered = donorsData.filter(d =>
      (blood === "" || d.blood === blood) &&
      (
        d.name.toLowerCase().includes(query) ||
        d.phone.includes(query) ||
        d.city.toLowerCase().includes(query) ||
        d.area.toLowerCase().includes(query) ||
        d.location.toLowerCase().includes(query)
      )
    );
    const tbody = document.getElementById("donorsTable");
    tbody.innerHTML = "";
    filtered.forEach((d, index) => {
      tbody.innerHTML += `<tr>
        <td data-label="Ø§Ù„Ø§Ø³Ù…">${d.name}</td>
        <td data-label="Ø§Ù„Ù‡Ø§ØªÙ"><a href="tel:${d.phone}">ğŸ“ Ø§ØªØµØ§Ù„</a><br>${d.phone}</td>
        <td data-label="Ø§Ù„ÙØµÙŠÙ„Ø©">${d.blood}</td>
        <td data-label="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©">${d.city}</td>
        <td data-label="Ø§Ù„Ù…Ø¯ÙŠØ±ÙŠØ©">${d.area}</td>
        <td data-label="Ø§Ù„Ø³ÙƒÙ†">${d.location}</td>
        <td data-label="Ø¢Ø®Ø± ØªØ¨Ø±Ø¹">${d.lastDate || "â€”"}</td>
        <td data-label="ØªØ¹Ø¯ÙŠÙ„"><button onclick="enableEditDate(${index})">ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ®</button></td>
      </tr>`;
    });
  }

  function enableEditDate(index) {
    currentDonorIndex = index;
    document.getElementById("updateDatePopup").classList.add("active");
  }

  function saveDonationDate() {
    const newDate = document.getElementById("newDonationDate").value;
    if (newDate.trim() === "") {
      alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¨Ø±Ø¹");
    } else {
      donorsData[currentDonorIndex].lastDate = newDate;
      localStorage.setItem('donors', JSON.stringify(donorsData));
      renderSearchTable();
      showMessage("ØªÙ… ØªØ­Ø¯ÙŠØ« ØªØ§Ø±ÙŠØ® ØªØ¨Ø±Ø¹Ùƒ Ø¨Ù†Ø¬Ø§Ø­");
      closeUpdateDatePopup();
    }
  }

  function closeUpdateDatePopup() {
    document.getElementById("updateDatePopup").classList.remove("active");
  }

  function showMessage(msg) {
    const popup = document.getElementById("successPopup");
    popup.innerHTML = msg;
    popup.classList.add("active");
    setTimeout(() => popup.classList.remove("active"), 3000);
  }

  renderSearchTable(); // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
</script>

</body>
</html>
